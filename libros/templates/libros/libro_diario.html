{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Libro Diario</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fuente opcional para n√∫meros tabulares -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'css/libro_diario.css' %}?v={% now 'U' %}">
</head>

<body>
  <div class="page">
    <header class="header">
      <div class="header__top">
        <div class="header__brand">
          <h1 class="brand__title">{{ empresa.nombre|default:"Nombre de Empresa no Definido" }}</h1>
          <p class="brand__subtitle">Libro de Diario</p>
        </div>
      </div>
      <div class="header__line"></div>
    </header>

    <main class="container">
      <a class="header__back" href="{% url 'home' %}">‚Üê Men√∫ Principal</a>

      <div class="table-wrap">
        <table class="report-table" aria-describedby="caption-diario">
          <caption id="caption-diario" class="sr-only">Libro diario con detalle de asientos y movimientos</caption>
          <thead>
            <tr>
              <th class="col-fecha">Fecha</th>
              <th class="col-numero">N¬∞</th>
              <th class="col-codigo">C√≥digo</th>
              <th class="col-descripcion">Descripci√≥n</th>
              <th class="col-debe numero">Debe</th>
              <th class="col-haber numero">Haber</th>
            </tr>
          </thead>
          <tbody>
            {% for asiento in asientos %}
            <tr class="asiento-header-row">
              <td>{{ asiento.fecha|date:"d/m/Y" }}</td>
              <td>{{ asiento.numero_asiento }}</td>

              <!-- Ocupa C√≥digo, Descripci√≥n y Debe -->
              <td colspan="3" class="asiento-descripcion">
                <strong>{{ asiento.descripcion }}</strong>
              </td>

              <!-- √öNICA celda final para la acci√≥n -->
              <td class="action-cell">
                <form action="{% url 'eliminar_asiento' asiento.id %}" method="post"
                  onsubmit="return confirm('¬øEst√°s seguro de que quieres eliminar este asiento permanentemente?');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger" title="Eliminar asiento">
                    üóëÔ∏è Eliminar
                  </button>

                </form>
              </td>
            </tr>

            {% for movimiento in asiento.movimientos.all %}
            <tr class="movimiento-row">
              <td colspan="2"></td>
              <td>{{ movimiento.cuenta.codigo }}</td>
              <td>{{ movimiento.cuenta.nombre }}</td>
              <td class="numero">${{ movimiento.debe|floatformat:2 }}</td>
              <td class="numero">${{ movimiento.haber|floatformat:2 }}</td>
            </tr>
            {% endfor %}
            {% empty %}
            <tr>
              <td colspan="6" style="text-align: center;">No hay asientos registrados para mostrar.</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4" class="totales-label">SUMAS IGUALES</td>
              <td class="numero total-debe">${{ gran_total_debe|floatformat:2 }}</td>
              <td class="numero total-haber">${{ gran_total_haber|floatformat:2 }}</td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Botones de exportaci√≥n e impresi√≥n -->
      <div class="after-table">
        <div class="btn-group">
          <a class="btn btn-outline" href="{% url 'libro_diario_excel' empresa_id=empresa.id %}">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <path fill="currentColor"
                d="M14 2H6a2 2 0 0 0-2 2v3h10zM4 9v9a2 2 0 0 0 2 2h8V9zm12-7h2a2 2 0 0 1 2 2v12h-4zM8.7 12h1.6l1.2 2.1 1.2-2.1h1.6l-2 3.2 2.1 3.3h-1.6l-1.3-2.3-1.3 2.3H8.7l2.1-3.3z" />
            </svg>
            <span>Exportar Excel</span>
          </a>

          <a class="btn btn-outline" href="{% url 'libro_diario_pdf' empresa_id=empresa.id %}" target="_blank"
            rel="noopener">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <path fill="currentColor"
                d="M14 2H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12V8zM14 8V2l6 6zM8 12h3a1.5 1.5 0 0 1 0 3H9v2H8zm1 1v1h2a.5.5 0 0 0 0-1zm6 4h-1v-5h2a1.5 1.5 0 0 1 0 3h-1zm0-3h1a.5.5 0 0 0 0-1h-1z" />
            </svg>
            <span>Exportar PDF</span>
          </a>

          <button class="btn btn-primary" onclick="window.print()">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <path fill="currentColor"
                d="M6 7V3h12v4H6Zm12 2H6a3 3 0 0 0-3 3v5h3v4h12v-4h3v-5a3 3 0 0 0-3-3Zm-2 10H8v-4h8v4Z" />
            </svg>
            <span>Imprimir</span>
          </button>
        </div>
      </div>
    </main>

    <footer class="footer">
      <small>¬© {{ now|date:"Y" }} Software Contable ¬∑ Libro Diario</small>
    </footer>
  </div>
</body>

</html>